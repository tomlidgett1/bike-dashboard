-- Repair: Ensure is_ai_generated column exists on product_images

DO $$
BEGIN
    IF NOT EXISTS (
        SELECT 1 FROM information_schema.columns 
        WHERE table_name = 'product_images' AND column_name = 'is_ai_generated'
    ) THEN
        ALTER TABLE product_images ADD COLUMN is_ai_generated BOOLEAN DEFAULT FALSE;
    END IF;
END $$;

-- Create index if it doesn't exist
CREATE INDEX IF NOT EXISTS idx_product_images_ai_generated 
  ON product_images(is_ai_generated) 
  WHERE is_ai_generated = TRUE;

COMMENT ON COLUMN product_images.is_ai_generated IS 'True if this image was generated by AI (e.g., background removal/optimization)';


